responses:
  - id: Q1
    query: |
      SELECT * FROM cypher('agri_graph', $$
        MATCH (farm:AgriFarm {name: 'ZESPRI AZ. AGR. DALLE FABBRICHE ANDREA'})<-[r:belongsTo]-(parcel:AgriParcel)
        RETURN farm, r, parcel
      $$) as (farm agtype, r agtype, parcel agtype);

  - id: Q2
    query: |
      SELECT * FROM cypher('agri_graph', $$
        MATCH (parcel:AgriParcel {name: 'Fondo Errano 2024 T0'})<-[r:belongsTo]-(device:Device)
        RETURN parcel, r, device
      $$) as (parcel agtype, r agtype, device agtype);

  - id: Q3
    query: |
      SELECT * FROM cypher('agri_graph', $$
        MATCH (device:Device)
        WHERE 'soilMoisture' = ANY(device.controlledProperty)
        RETURN device
      $$) as (device agtype);

  - id: Q4
    query: |
      SELECT * FROM cypher('agri_graph', $$
        MATCH (farm:AgriFarm)-[r1*]->(parcel:AgriParcel)-[r2:belongsTo]-(device:Device)
        WHERE farm.name CONTAINS 'ZESPRI' AND 'soilMoisture' = ANY(device.controlledProperty)
        RETURN farm, r1, parcel, r2, device
      $$) as (farm agtype, r1 agtype, parcel agtype, r2 agtype, device agtype);

  - id: Q5
    query: |
      SELECT * FROM cypher('agri_graph', $$
        MATCH (farm:AgriFarm)<-[r:belongsTo]-(parcel:AgriParcel)
        WHERE parcel.colture CONTAINS 'Kiwi'
        RETURN farm, r, parcel
      $$) as (farm agtype, r agtype, parcel agtype);

  - id: Q6
    query: |
      SELECT * FROM cypher('agri_graph', $$
        MATCH (parcel:AgriParcel)-[r:belongsTo]-(device:Device)
        WHERE parcel.name = 'Fondo Errano 2024 T1' AND parcel.irrigationSystemType = 'Drip irrigation'
        RETURN parcel, r, device
      $$) as (parcel agtype, r agtype, device agtype);

  - id: Q7
    query: |
      SELECT * FROM cypher('agri_graph', $$
        MATCH (device:Device)
        WHERE 'soilMoisture' = ANY(device.controlledProperty) AND device.value IS NOT NULL
        WITH device, device.value[0] AS moisture_value
        ORDER BY moisture_value ASC
        LIMIT 1
        RETURN device
      $$) as (device agtype);

  - id: Q8
    query: |
      SELECT * FROM cypher('agri_graph', $$
        MATCH (device:Device)
        WHERE device.location IS NOT NULL
        WITH device, 
             point({longitude: 11.799, latitude: 44.235}) AS target_point,
             point({longitude: split(replace(replace(device.location, 'POINT (', ''), ')', ''), ' ')[0]::float, 
                    latitude: split(replace(replace(device.location, 'POINT (', ''), ')', ''), ' ')[1]::float}) AS device_point
        WITH device, distance(target_point, device_point) AS dist
        ORDER BY dist ASC
        LIMIT 1
        RETURN device
      $$) as (device agtype);

  - id: Q9
    query: |
      SELECT * FROM cypher('agri_graph', $$
        MATCH (parcel:AgriParcel)<-[r:belongsTo]-(device:Device)
        WITH parcel, COUNT(device) AS device_count, COLLECT(r) AS relationships, COLLECT(device) AS devices
        ORDER BY device_count DESC
        LIMIT 1
        UNWIND relationships AS rel
        UNWIND devices AS dev
        RETURN parcel, rel, dev
      $$) as (parcel agtype, rel agtype, dev agtype);

  - id: Q10
    query: |
      SELECT * FROM cypher('agri_graph', $$
        MATCH (device:Device)-[r:belongsTo]->(parcel:AgriParcel)
        WHERE 'temperature' = ANY(device.controlledProperty)
        WITH device, parcel, r, device.value[0] AS temp_value
        ORDER BY temp_value ASC
        LIMIT 1
        RETURN device, r, parcel
      $$) as (device agtype, r agtype, parcel agtype)
      UNION
      SELECT d.*, rel.*, p.*
      FROM public.measurements m
      JOIN cypher('agri_graph', $$
        MATCH (device:Device)-[r:belongsTo]->(parcel:AgriParcel)
        RETURN device, r, parcel
      $$) as (device agtype, r agtype, parcel agtype) ON m.device_id = (device->>'id')::text
      WHERE m.controlled_property = 'temperature'
      ORDER BY m.value ASC
      LIMIT 1;