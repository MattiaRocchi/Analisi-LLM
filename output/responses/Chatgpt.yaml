responses:
  - id: "Q1"
    query: |
      SELECT * FROM cypher('agri_graph', $$
        MATCH (p:AgriParcel)-[r:belongsTo]->(f:AgriFarm)
        RETURN f, r, p
        ORDER BY f.name, p.name
      $$) AS (f agtype, r agtype, p agtype);

  - id: "Q2"
    query: |
      SELECT * FROM cypher('agri_graph', $$
        MATCH (d:Device)-[r:belongsTo]->(p:AgriParcel)
        WHERE p.name = 'Fondo Errano 2024 T0'
        RETURN p, r, d
        ORDER BY d.name
      $$) AS (p agtype, r agtype, d agtype);

  - id: "Q3"
    query: |
      SELECT * FROM cypher('agri_graph', $$
        MATCH (d:Device)-[r:belongsTo]->(p:AgriParcel)-[:belongsTo]->(f:AgriFarm)
        WHERE 'soilMoisture' IN d.controlledProperty
        RETURN f, p, d, r
        ORDER BY f.name, p.name
      $$) AS (f agtype, p agtype, d agtype, r agtype);

  - id: "Q4"
    query: |
      SELECT * FROM cypher('agri_graph', $$
        MATCH (f:AgriFarm)<-[:belongsTo]-(p:AgriParcel)<-[r:belongsTo]-(d:Device)
        WHERE 'soilMoisture' IN d.controlledProperty
        RETURN f, p, d
        ORDER BY f.name, p.name
      $$) AS (f agtype, p agtype, d agtype);

  - id: "Q5"
    query: |
      SELECT * FROM cypher('agri_graph', $$
        MATCH (p:AgriParcel)-[:belongsTo]->(f:AgriFarm)
        WHERE toLower(p.colture) LIKE '%kiwi%'
        RETURN f, p
        ORDER BY f.name, p.name
      $$) AS (f agtype, p agtype);

  - id: "Q6"
    query: |
      SELECT * FROM cypher('agri_graph', $$
        MATCH (d:Device)-[r:belongsTo]->(p:AgriParcel)-[:belongsTo]->(f:AgriFarm)
        WHERE 'dripper' IN d.controlledProperty
           OR toLower(COALESCE(p.irrigationSystemType, '')) LIKE '%drip%'
        RETURN f, p, d
        ORDER BY f.name, p.name
      $$) AS (f agtype, p agtype, d agtype);

  - id: "Q7"
    query: |
      SELECT * FROM (
        SELECT d, m
        FROM cypher('agri_graph', $$
          MATCH (f:AgriFarm)<-[:belongsTo]-(p:AgriParcel)<-[r:belongsTo]-(d:Device)
          WHERE 'soilMoisture' IN d.controlledProperty
          RETURN f, p, d
        $$) AS (f agtype, p agtype, d agtype)
        JOIN LATERAL (
          SELECT m.*
          FROM public.measurements m
          WHERE m.device_id = (d->'properties'->>'id')
            AND m.controlled_property = 'soilMoisture'
          ORDER BY (m.value::numeric) ASC
          LIMIT 1
        ) AS m ON TRUE
        ORDER BY (m.value::numeric) ASC
        LIMIT 1
      ) AS q;

  - id: "Q8"
    query: |
      SELECT * FROM cypher('agri_graph', $$
        MATCH (d:Device)-[:belongsTo]->(p:AgriParcel)-[:belongsTo]->(f:AgriFarm)
        WHERE exists(d.location) OR exists(d.properties.location)
        RETURN f, p, d
      $$) AS (f agtype, p agtype, d agtype)
      ORDER BY ST_Distance(
        ST_SetSRID(
          ST_GeomFromText(
            COALESCE(
              (d->'properties'->>'location'),
              d.location::text
            )
          ), 4326
        ),
        ST_SetSRID(ST_GeomFromText('POINT(11.799 44.235)'), 4326)
      )
      LIMIT 1;

  - id: "Q9"
    query: |
      SELECT * FROM cypher('agri_graph', $$
        MATCH (d:Device)-[:belongsTo]->(p:AgriParcel)-[:belongsTo]->(f:AgriFarm)
        WITH f, p, collect(d) AS devices, count(d) AS dev_count
        ORDER BY dev_count DESC
        LIMIT 1
        RETURN f, p, devices, dev_count
      $$) AS (f agtype, p agtype, devices agtype, dev_count int);

  - id: "Q10"
    query: |
      SELECT * FROM (
        SELECT f, p, d, m
        FROM cypher('agri_graph', $$
          MATCH (f:AgriFarm)<-[:belongsTo]-(p:AgriParcel)<-[r:belongsTo]-(d:Device)
          WHERE 'soilMoisture' IN d.controlledProperty
          RETURN f, p, d
        $$) AS (f agtype, p agtype, d agtype)
        JOIN LATERAL (
          SELECT m.*
          FROM public.measurements m
          WHERE m.device_id = (d->'properties'->>'id')
            AND m.controlled_property = 'soilMoisture'
          ORDER BY (m.value::numeric) ASC
          LIMIT 1
        ) AS m ON TRUE
        ORDER BY (m.value::numeric) ASC
        LIMIT 1
      ) AS q;