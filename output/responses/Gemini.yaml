responses:
  - id: Q1
    cypher_query: |
      MATCH (f:AgriFarm {name: 'ZESPRI AZ. AGR. DALLE FABBRICHE ANDREA'}) <-[:belongsTo]- (p:AgriParcel)
      RETURN f, p
  - id: Q2
    cypher_query: |
      MATCH (p:AgriParcel {name: 'Fondo Errano 2024 T0'}) -[:hasDevice]-> (d:Device)
      RETURN p, d
  - id: Q3
    cypher_query: |
      MATCH (d:Device)
      WHERE 'soilMoisture' = ANY(prop IN d.controlledProperty)
      RETURN d
  - id: Q4
    cypher_query: |
      MATCH (f:AgriFarm {name: 'ZESPRI AZ. AGR. DALLE FABBRICHE ANDREA'}) <-[:belongsTo]- (p:AgriParcel)
      MATCH (p) <-[:belongsTo]- (dh:Device) -[:hasDevice]-> (d:Device)
      WHERE 'soilMoisture' = ANY(prop IN d.controlledProperty)
      RETURN f, p, dh, d
  - id: Q5
    cypher_query: |
      MATCH (f:AgriFarm {name: 'ZESPRI AZ. AGR. DALLE FABBRICHE ANDREA'}) <-[:belongsTo]- (p:AgriParcel)
      WHERE p.colture CONTAINS 'Kiwi'
      RETURN f, p
  - id: Q6
    cypher_query: |
      MATCH (p:AgriParcel {name: 'T1'}) -[:hasDevice]-> (d:Device)
      WHERE 'dripper' = ANY(prop IN d.controlledProperty)
      RETURN p, d
  - id: Q7
    cypher_query: |
      MATCH (d:Device)
      WHERE 'soilMoisture' = ANY(prop IN d.controlledProperty)
      WITH d, d.value[0] AS moistureValue
      ORDER BY moistureValue ASC
      LIMIT 1
      MATCH (d) -[r]- (n)
      RETURN d, r, n
  - id: Q8
    cypher_query: |
      // Target Point: (11.799, 44.235)
      MATCH (d:Device)
      WHERE exists(d.location) AND d.location STARTS WITH 'POINT'
      WITH d,
           split(d.location, ' ')[1] AS lon_str,
           split(d.location, ' ')[2] AS lat_str
      WITH d, toFloat(lon_str) AS d_lon, toFloat(lat_str) AS d_lat
      WITH d,
           ((11.799 - d_lon)^2 + (44.235 - d_lat)^2) AS distance_metric // Using squared distance for ordering
      ORDER BY distance_metric ASC
      LIMIT 1
      MATCH (d) -[r]- (n)
      RETURN d, r, n
  - id: Q9
    cypher_query: |
      MATCH (f:AgriFarm {name: 'ZESPRI AZ. AGR. DALLE FABBRICHE ANDREA'}) <-[:belongsTo]- (p:AgriParcel)
      MATCH (p) <-[:belongsTo]- (dh:Device)
      OPTIONAL MATCH (dh) -[:hasDevice]-> (d:Device)
      WITH p, count(d) + 1 AS totalDevices // +1 for the hub device itself
      ORDER BY totalDevices DESC
      LIMIT 1
      MATCH (p) -[r]- (n)
      RETURN p, r, n
  - id: Q10
    cypher_query: |
      WITH (
        SELECT device_id FROM public.measurements
        WHERE controlled_property = 'temperature'
        ORDER BY value ASC
        LIMIT 1
      ) AS min_temp_device_id
      SELECT * FROM cypher('agri_graph', $$
        MATCH (d:Device)
        WHERE d.id = min_temp_device_id
        MATCH (d) -[r]- (n)
        RETURN d, r, n
      $$) AS (d agtype, r agtype, n agtype)